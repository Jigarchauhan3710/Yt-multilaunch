<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta name="theme-color" content="#FF0000">
<title>YT MultiLaunch v9</title>
<style>
:root{--r:#FF0000;--r2:#CC0000;--r3:#990000;--off:#F9F9F9;--lg:#E5E5E5;--mg:#999;--dg:#282828;--tx:#0F0F0F;--green:#2e7d32;--greenl:#e8f5e9;}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{font-family:-apple-system,Roboto,Arial,sans-serif;background:var(--off);color:var(--tx);min-height:100vh;}
header{background:#fff;border-bottom:1px solid var(--lg);padding:12px 16px;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:100;box-shadow:0 1px 6px rgba(0,0,0,0.08);}
.logo{width:36px;height:26px;background:var(--r);border-radius:7px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.logo svg{width:15px;height:15px;fill:#fff;}
.ltxt{font-size:17px;font-weight:700;}.ltxt b{color:var(--r);}
.badge{margin-left:auto;background:var(--r);color:#fff;font-size:10px;font-weight:700;padding:3px 8px;border-radius:20px;}
.hero{background:linear-gradient(135deg,var(--r),var(--r3));padding:32px 16px 52px;text-align:center;position:relative;overflow:hidden;}
.hero::before{content:'';position:absolute;inset:0;background:repeating-linear-gradient(45deg,rgba(255,255,255,0.03) 0,rgba(255,255,255,0.03) 1px,transparent 0,transparent 50%) 0 0/16px 16px;}
.hero h1{font-size:clamp(20px,5vw,34px);font-weight:800;color:#fff;margin-bottom:8px;position:relative;line-height:1.2;}
.hero p{color:rgba(255,255,255,0.8);font-size:13px;position:relative;}
.card{background:#fff;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.1);padding:22px 18px;max-width:600px;width:calc(100% - 24px);margin:-30px auto 20px;position:relative;z-index:10;}
.step{margin-bottom:20px;}
.sl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--r);margin-bottom:7px;display:flex;align-items:center;gap:5px;}
.sn{background:var(--r);color:#fff;width:16px;height:16px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;}
.irow{display:flex;}
.irow input{flex:1;border:2px solid var(--lg);border-radius:10px 0 0 10px;padding:13px 12px;font-size:14px;font-family:inherit;color:var(--tx);outline:none;background:var(--off);min-width:0;transition:border-color 0.2s;}
.irow input:focus{border-color:var(--r);background:#fff;}
.irow input::placeholder{color:var(--mg);}
.pbtn{background:var(--lg);border:2px solid var(--lg);border-left:none;border-radius:0 10px 10px 0;padding:0 12px;font-size:12px;font-weight:700;color:var(--dg);cursor:pointer;white-space:nowrap;}
#prev{display:none;margin-top:10px;border-radius:10px;overflow:hidden;border:1px solid var(--lg);cursor:pointer;position:relative;}
#thumb{width:100%;aspect-ratio:16/9;display:block;object-fit:cover;background:#000;}
.play-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:52px;height:52px;background:rgba(255,0,0,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;}
.play-btn svg{width:20px;height:20px;fill:#fff;margin-left:3px;}
#prev-lbl{padding:7px 12px;font-size:11px;color:var(--dg);font-weight:600;background:#fff;}
.warn{background:#fff0f0;border:1.5px solid #fcc;border-radius:8px;padding:9px 12px;font-size:12px;color:#900;margin-top:7px;display:none;}

/* LOGIN STATUS BANNER */
#login-banner{max-width:600px;width:calc(100% - 24px);margin:0 auto 12px;border-radius:12px;padding:13px 16px;font-size:12px;line-height:1.7;display:none;}
#login-banner.loggedin{background:#fff3e0;border:1.5px solid #ffb74d;color:#e65100;}
#login-banner.loggedout{background:var(--greenl);border:1.5px solid #81c784;color:#1b5e20;}

.crow{display:flex;align-items:center;gap:10px;}
.cbtn{width:40px;height:40px;border-radius:50%;border:2px solid var(--lg);background:#fff;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--dg);flex-shrink:0;user-select:none;}
#ci{flex:1;border:2px solid var(--lg);border-radius:10px;padding:10px;font-size:22px;font-weight:700;text-align:center;color:var(--tx);outline:none;font-family:inherit;max-width:100px;}
#ci:focus{border-color:var(--r);}
.pres{display:flex;gap:6px;flex-wrap:wrap;margin-top:9px;}
.pre{padding:5px 12px;border-radius:20px;border:1.5px solid var(--lg);background:#fff;font-size:12px;font-weight:700;cursor:pointer;color:var(--dg);}
.pre.on{background:var(--r);border-color:var(--r);color:#fff;}
.mrow{display:flex;gap:8px;}
.mo{flex:1;border:2px solid var(--lg);border-radius:10px;padding:11px 8px;cursor:pointer;text-align:center;user-select:none;transition:border-color 0.15s;}
.mo.sel{border-color:var(--r);background:rgba(255,0,0,0.04);}
.mo input{display:none;}
.mi{font-size:20px;display:block;margin-bottom:2px;}.mn{font-size:12px;font-weight:700;}.md{font-size:10px;color:var(--mg);margin-top:1px;}
.box{border-radius:10px;padding:11px 14px;font-size:12px;line-height:1.6;margin-top:10px;}
.box-g{background:var(--greenl);border:1.5px solid #81c784;color:#1b5e20;}
.box-y{background:#fff8e1;border:1.5px solid #ffe082;color:#5d4037;}
.box-r{background:#fff0f0;border:1.5px solid #ffaaaa;color:#900;}
.box-o{background:#fff3e0;border:1.5px solid #ffb74d;color:#e65100;}
.lbtn{width:100%;padding:15px;background:var(--r);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;font-family:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:12px;}
.lbtn:disabled{background:#ccc;cursor:not-allowed;}
.lbtn svg{width:18px;height:18px;fill:#fff;}
#result-sec{display:none;max-width:600px;width:calc(100% - 24px);margin:0 auto 20px;}
.res-card{background:#fff;border-radius:16px;padding:20px 18px;box-shadow:0 2px 14px rgba(0,0,0,0.08);}
.res-top{display:flex;align-items:center;gap:12px;margin-bottom:14px;}
.res-icon{font-size:32px;}.res-title{font-size:15px;font-weight:700;}.res-sub{font-size:12px;color:var(--mg);margin-top:2px;}
.pb{background:var(--lg);border-radius:100px;height:8px;overflow:hidden;margin-bottom:8px;}
.pf{height:100%;background:linear-gradient(90deg,var(--r),#ff6b6b);border-radius:100px;transition:width 0.4s;}
.pm{display:flex;justify-content:space-between;font-size:11px;color:var(--mg);margin-bottom:14px;}
#allow-guide{display:none;background:#fff8e1;border:1.5px solid #ffe082;border-radius:12px;padding:14px 16px;font-size:12px;color:#5d4037;line-height:1.8;margin-top:12px;}
#allow-guide .step-row{display:flex;align-items:flex-start;gap:8px;margin-bottom:4px;}
#allow-guide .num{background:var(--r);color:#fff;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;margin-top:1px;}
.retry-btn{width:100%;padding:13px;background:var(--r);color:#fff;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;margin-top:12px;display:flex;align-items:center;justify-content:center;gap:6px;}
#prog-sec{display:none;max-width:600px;width:calc(100% - 24px);margin:0 auto 20px;}
.pc{background:#fff;border-radius:16px;padding:20px;box-shadow:0 2px 14px rgba(0,0,0,0.08);}
.pt{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
#pc2{font-size:24px;font-weight:700;color:var(--r);}
#sbtn{background:#fff;border:2px solid var(--r);color:var(--r);border-radius:8px;padding:8px 16px;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;margin-top:12px;}
#view-tracker{display:none;max-width:600px;width:calc(100% - 24px);margin:0 auto 16px;}
.vt-card{background:#fff;border-radius:14px;padding:16px 18px;box-shadow:0 2px 12px rgba(0,0,0,0.08);}
.vt-title{font-size:13px;font-weight:700;margin-bottom:10px;}
.vt-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:10px;}
.vt-box{background:var(--off);border-radius:10px;padding:10px;text-align:center;}
.vt-num{font-size:22px;font-weight:800;color:var(--r);}
.vt-num.green{color:var(--green);}
.vt-lbl{font-size:10px;color:var(--mg);margin-top:2px;}
.vt-note{font-size:11px;color:#888;border-top:1px solid var(--lg);padding-top:9px;line-height:1.6;}
#fr-sec{display:none;max-width:600px;width:calc(100% - 24px);margin:0 auto 24px;}
.fb{display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;}
.ft{font-size:13px;font-weight:700;}
.clr{background:none;border:1.5px solid var(--lg);border-radius:8px;padding:5px 11px;font-size:12px;font-weight:600;cursor:pointer;color:var(--dg);}
.fg{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:9px;}
.fi{background:#000;border-radius:10px;overflow:hidden;animation:fi 0.3s ease;box-shadow:0 2px 10px rgba(0,0,0,0.15);}
.fi iframe{width:100%;aspect-ratio:16/9;display:block;border:none;}
.fl{background:var(--dg);color:#fff;font-size:10px;font-weight:600;padding:5px 9px;display:flex;align-items:center;justify-content:space-between;gap:4px;}
.fd{width:6px;height:6px;background:var(--r);border-radius:50%;animation:pulse 1.5s infinite;flex-shrink:0;}
.vtimer{font-size:10px;font-weight:700;padding:2px 7px;border-radius:10px;background:rgba(255,255,255,0.13);color:#fff;white-space:nowrap;}
.vtimer.playing{background:#1565c0;}.vtimer.done{background:#2e7d32;}.vtimer.err{background:#b71c1c;}
.fp{position:relative;width:100%;aspect-ratio:16/9;cursor:pointer;overflow:hidden;background:#000;}
.fp img{width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.2s;}
.fp:hover img{transform:scale(1.03);}
.fp-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.38);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;}
.fp-play{width:62px;height:62px;background:rgba(255,0,0,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 18px rgba(255,0,0,0.5);}
.fp-play svg{width:26px;height:26px;fill:#fff;margin-left:4px;}
.fp-label{color:#fff;font-size:11px;font-weight:700;background:rgba(0,0,0,0.6);padding:4px 10px;border-radius:20px;}
.fi.playing .fp{display:none;}
.fi:not(.playing) iframe{display:none;}
#info-panel{display:none;max-width:600px;width:calc(100% - 24px);margin:0 auto 12px;}
.ip-inner{background:#fff;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,0.07);overflow:hidden;}
.ip-top{padding:14px 16px;border-bottom:1px solid #eee;}
#autoplay-btn{width:100%;padding:14px;background:linear-gradient(135deg,#FF0000,#CC0000);color:#fff;border:none;border-radius:10px;font-size:15px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;font-family:inherit;}
.ip-note{font-size:11px;color:#999;text-align:center;margin-top:6px;}
.div{height:1px;background:var(--lg);max-width:600px;width:calc(100% - 24px);margin:0 auto 14px;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes fi{from{opacity:0;transform:scale(0.94)}to{opacity:1;transform:scale(1)}}
footer{text-align:center;padding:24px 16px;font-size:11px;color:var(--mg);}
</style>
</head>
<body>

<header>
  <div class="logo"><svg viewBox="0 0 24 24"><path d="M9.5 16.5v-9l7 4.5-7 4.5z"/></svg></div>
  <span class="ltxt">YT <b>Multi</b>Launch</span>
  <span class="badge">v9</span>
</header>

<div class="hero">
  <h1>ğŸš€ One Video.<br>Unlimited Screens.</h1>
  <p>IFrame API Â· Cookie isolation Â· Logged-out detection Â· 30s view tracking</p>
</div>

<!--
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  LOGIN STATUS BANNER â€” detected on page load
  Shown right at the top so user knows their cookie state
  before launching any screens
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<div id="login-banner"></div>

<div class="card">
  <div class="step">
    <div class="sl"><span class="sn">1</span> Paste YouTube URL</div>
    <div class="irow">
      <input type="url" id="url-in" placeholder="https://youtube.com/watch?v=..." inputmode="url" autocomplete="off" spellcheck="false">
      <button class="pbtn" onclick="doPaste()">ğŸ“‹ Paste</button>
    </div>
    <div id="prev" onclick="openVid()">
      <img id="thumb" src="" alt="">
      <div class="play-btn"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
      <div id="prev-lbl">âœ… Video found â€” tap to preview</div>
    </div>
    <div class="warn" id="uw">âš ï¸ Please enter a valid YouTube URL</div>
  </div>

  <div class="step">
    <div class="sl"><span class="sn">2</span> How many screens?</div>
    <div class="crow">
      <button class="cbtn" onclick="adj(-1)">âˆ’</button>
      <input type="number" id="ci" value="5" min="1" max="50">
      <button class="cbtn" onclick="adj(1)">+</button>
    </div>
    <div class="pres">
      <button class="pre" onclick="sp(this,2)">2</button>
      <button class="pre" onclick="sp(this,5)">5</button>
      <button class="pre" onclick="sp(this,10)">10</button>
      <button class="pre" onclick="sp(this,25)">25</button>
      <button class="pre" onclick="sp(this,50)">50</button>
    </div>
    <div class="box box-r" style="margin-top:9px">
      âš ï¸ <b>Hard limits that no code can bypass:</b><br>
      â€¢ Same IP = max ~4â€“5 counted views/day<br>
      â€¢ Same Google account across all iframes = 1 identity<br>
      â€¢ Same browser fingerprint = detected as one device<br>
      ğŸ‘‰ For real views: share to friends on different networks
    </div>
  </div>

  <div class="step">
    <div class="sl"><span class="sn">3</span> Mode</div>
    <div class="mrow">
      <label class="mo sel" id="m1">
        <input type="radio" name="mode" value="tabs" checked onchange="sm(this)">
        <span class="mi">ğŸ—‚ï¸</span><div class="mn">New Tabs</div><div class="md">youtube.com direct</div>
      </label>
      <label class="mo" id="m2">
        <input type="radio" name="mode" value="inline" onchange="sm(this)">
        <span class="mi">ğŸ“±</span><div class="mn">Same Screen</div><div class="md">IFrame API + isolation</div>
      </label>
    </div>
    <div class="box box-g" id="tip-tabs" style="display:block">
      ğŸ—‚ï¸ <b>Tabs:</b> Cleanest traffic source â€” direct <code>youtube.com/watch</code> URL. Each tab is a separate browser context. Watch 30s+ per tab.
    </div>
    <div class="box box-y" id="tip-inline" style="display:none">
      ğŸ“± <b>Same Screen:</b> Each iframe uses <code>allow="storage-access"</code> isolation + IFrame API <code>onStateChange</code> for confirmed play detection. 30s timer starts only when YouTube confirms playback.
    </div>
  </div>

  <button class="lbtn" id="lb" onclick="launch()">
    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    Launch All Videos
  </button>
</div>

<!-- TABS RESULT -->
<div id="result-sec">
  <div class="res-card">
    <div class="res-top">
      <div class="res-icon" id="res-icon">ğŸš€</div>
      <div>
        <div class="res-title" id="res-title">Opening tabs...</div>
        <div class="res-sub" id="res-sub">Watch 30+ seconds per tab</div>
      </div>
    </div>
    <div class="pb"><div class="pf" id="res-bar"></div></div>
    <div class="pm"><span id="res-opened">0 opened</span><span id="res-total">of 0</span></div>
    <div id="allow-guide">
      <b>âš ï¸ Chrome blocked popups â€” 3-step fix:</b><br><br>
      <div class="step-row"><span class="num">1</span><span>Chrome address bar â†’ find <b>ğŸš« blocked popup icon</b></span></div>
      <div class="step-row"><span class="num">2</span><span>Click it â†’ <b>"Always allow popups from this site"</b> â†’ Done</span></div>
      <div class="step-row"><span class="num">3</span><span>Click the button below</span></div>
      <button class="retry-btn" onclick="retryLaunch()">ğŸ”„ Open All Tabs Now</button>
    </div>
  </div>
</div>

<!-- PROGRESS -->
<div id="prog-sec">
  <div class="pc">
    <div class="pt">
      <div>
        <div style="font-weight:700;font-size:14px">ğŸ“º Building screens...</div>
        <div style="font-size:11px;color:var(--mg);margin-top:2px" id="psub">Loading YouTube IFrame API...</div>
      </div>
      <div id="pc2">0</div>
    </div>
    <div class="pb"><div class="pf" id="pb2"></div></div>
    <div class="pm" style="margin-bottom:4px"><span id="pd">0 done</span><span id="pt2">of 0</span></div>
    <button id="sbtn" onclick="doStop()">â¹ Stop</button>
  </div>
</div>

<!-- VIEW TRACKER -->
<div id="view-tracker">
  <div class="vt-card">
    <div class="vt-title">ğŸ“Š Real-Time View Eligibility</div>
    <div class="vt-grid">
      <div class="vt-box"><div class="vt-num" id="vt-playing">0</div><div class="vt-lbl">Playing</div></div>
      <div class="vt-box"><div class="vt-num" id="vt-counting">0</div><div class="vt-lbl">â± Counting</div></div>
      <div class="vt-box"><div class="vt-num green" id="vt-eligible">0</div><div class="vt-lbl">âœ… Eligible</div></div>
    </div>
    <div class="vt-note" id="vt-note">
      âœ… <b>Eligible</b> = IFrame API confirmed playback (state=1) AND 30s of actual watch time.<br>
      âš ï¸ YouTube deduplicates by IP + cookies â€” only ~4â€“5 will appear in Analytics.
    </div>
  </div>
</div>

<!-- AUTO PLAY -->
<div id="info-panel">
  <div class="ip-inner">
    <div class="ip-top">
      <button id="autoplay-btn" onclick="autoPlayAll()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M8 5v14l11-7z"/></svg>
        â–¶ Auto Play All Screens
      </button>
      <div class="ip-note">1.2s delay between screens Â· 30s timer starts on confirmed play only</div>
    </div>
  </div>
</div>

<!-- FRAMES GRID -->
<div id="fr-sec">
  <div class="div"></div>
  <div style="max-width:600px;width:calc(100% - 24px);margin:0 auto 9px">
    <div class="fb">
      <div class="ft">ğŸ“º <span id="fc">0</span> Screens</div>
      <div style="display:flex;gap:7px">
        <button class="clr" id="stopall-btn" onclick="stopAllVideos()" style="background:#fff0f0;border-color:#fcc;color:#c00;">â¹ Stop All</button>
        <button class="clr" onclick="clrF()">âœ• Clear</button>
      </div>
    </div>
  </div>
  <div class="fg" id="fg"></div>
</div>

<footer>YT MultiLaunch v9 Â· IFrame API Â· Cookie isolation Â· Max ~4â€“5 views/IP/day Â· Not affiliated with YouTube</footer>

<script>
// â”€â”€ GLOBAL STATE â”€â”€
let curV='',lastVid='',lastCount=0,sf=false,inlineTimer=null;
const players={}, viewState={};
let totalPlaying=0,totalCounting=0,totalEligible=0;
let userIsLoggedIn = false; // detected on load

function g(id){return document.getElementById(id);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN STATUS DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// YouTube sets the VISITOR_INFO1_LIVE cookie for ALL visitors
// (logged in or not). However, we can detect login state by
// attempting to fetch a Google endpoint that only works when
// authenticated. We use the YouTube homepage meta check:
// a logged-in user gets a different response headers/body.
//
// Most reliable browser-accessible method: check if the
// google.com accounts cookie is readable via an image probe.
// We fetch the YouTube avatar endpoint â€” it 200s when logged in
// and 401/redirects when not.
//
// NOTE: This is a heuristic â€” YouTube's own cookies are
// HttpOnly and SameSite=None so we cannot READ them directly.
// We use a public Google profile image endpoint as a probe.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function detectLoginStatus(){
  const banner = g('login-banner');
  try{
    // Probe: fetch Google's account info endpoint
    // If user is logged in to Google, this resolves with profile data
    // If not, it returns a 401 or redirect â€” fetch will get opaque response
    const resp = await fetch('https://www.googleapis.com/oauth2/v1/userinfo', {
      method:'GET',
      credentials:'include', // sends Google cookies
      mode:'cors'
    });
    if(resp.ok){
      userIsLoggedIn = true;
    } else {
      userIsLoggedIn = false;
    }
  } catch(e){
    // CORS block = not logged in, or request blocked
    userIsLoggedIn = false;
  }

  // Show banner
  banner.style.display = 'block';
  if(userIsLoggedIn){
    banner.className = 'loggedin';
    banner.innerHTML = `
      <b>âš ï¸ You are logged into Google/YouTube in this browser.</b><br>
      All iframes will share your Google account identity â€” YouTube will see every screen as the <b>same user</b>.<br>
      <b>For better view counting: <a href="https://accounts.google.com/logout" target="_blank" style="color:#e65100">log out of YouTube</a> first, then reopen this page.</b>`;
  } else {
    banner.className = 'loggedout';
    banner.innerHTML = `
      âœ… <b>Not logged into Google in this browser.</b> 
      Each iframe will be treated as an anonymous visitor â€” better for view deduplication. 
      Keep it this way for maximum view eligibility.`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// YOUTUBE IFRAME API BOOTSTRAP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let ytApiReady=false;
const ytInitQueue=[];

window.onYouTubeIframeAPIReady=function(){
  ytApiReady=true;
  ytInitQueue.forEach(item=>createYTPlayer(item.iframeId,item.idx));
  ytInitQueue.length=0;
};

function loadYTApi(){
  if(document.getElementById('yt-api-script')) return;
  const s=document.createElement('script');
  s.id='yt-api-script';
  s.src='https://www.youtube.com/iframe_api';
  document.head.appendChild(s);
}

function createYTPlayer(iframeId,idx){
  const iframe=document.getElementById(iframeId);
  if(!iframe||players[idx]) return;
  players[idx]=new YT.Player(iframeId,{
    events:{
      onReady:()=>{},
      onStateChange:(e)=>handleStateChange(e,idx),
      onError:(e)=>{
        const el=g('vt-'+idx);
        if(el){el.textContent='âŒ Error';el.className='vtimer err';}
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE CHANGE HANDLER
// state=1 PLAYING â†’ start 30s timer (pauses on state=2)
// state=0 ENDED   â†’ short video, mark eligible immediately
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handleStateChange(event,idx){
  const state=event.data;
  const el=g('vt-'+idx);
  if(!viewState[idx]) viewState[idx]={playing:false,watchSecs:0,eligible:false,interval:null};
  const vs=viewState[idx];

  if(state===YT.PlayerState.PLAYING){
    if(!vs.playing){
      vs.playing=true; totalPlaying++;
      if(!vs.eligible) totalCounting++;
      updateTracker();
    }
    if(!vs.interval&&!vs.eligible){
      vs.interval=setInterval(()=>{
        vs.watchSecs++;
        const rem=30-vs.watchSecs;
        if(el&&rem>0){el.textContent=`â± ${rem}s`;el.className='vtimer playing';}
        if(vs.watchSecs>=30&&!vs.eligible){
          vs.eligible=true; totalEligible++;
          totalCounting=Math.max(0,totalCounting-1);
          clearInterval(vs.interval); vs.interval=null;
          if(el){el.textContent='âœ… View!';el.className='vtimer done';}
          updateTracker();
        }
      },1000);
    }
  } else if(state===YT.PlayerState.PAUSED){
    if(vs.interval){clearInterval(vs.interval);vs.interval=null;}
    if(el&&!vs.eligible) el.textContent='â¸ Paused';
  } else if(state===YT.PlayerState.ENDED){
    if(vs.interval){clearInterval(vs.interval);vs.interval=null;}
    if(vs.playing&&!vs.eligible){
      vs.eligible=true; totalEligible++;
      totalCounting=Math.max(0,totalCounting-1);
      if(el){el.textContent='âœ… View!';el.className='vtimer done';}
      updateTracker();
    }
  } else if(state===YT.PlayerState.BUFFERING){
    if(el&&!vs.eligible) el.textContent='â³ Buffering';
  }
}

function updateTracker(){
  g('vt-playing').textContent=totalPlaying;
  g('vt-counting').textContent=totalCounting;
  g('vt-eligible').textContent=totalEligible;
}

// â”€â”€ URL HELPERS â”€â”€
function gvid(u){
  if(!u) return null; let m;
  if((m=u.match(/youtu.be/([a-zA-Z0-9_-]{11})/))) return m[1];
  if((m=u.match(/[?&]v=([a-zA-Z0-9_-]{11})/))) return m[1];
  if((m=u.match(/embed/([a-zA-Z0-9_-]{11})/))) return m[1];
  if((m=u.match(/shorts/([a-zA-Z0-9_-]{11})/))) return m[1];
  return null;
}
async function doPaste(){
  try{const t=await navigator.clipboard.readText();g('url-in').value=t;hurl(t);}
  catch(e){g('url-in').focus();}
}
g('url-in').addEventListener('input',e=>hurl(e.target.value));
g('url-in').addEventListener('paste',e=>setTimeout(()=>hurl(e.target.value),50));
function hurl(v){
  const vid=gvid(v.trim());g('uw').style.display='none';
  if(vid){curV=vid;g('thumb').src=`https://img.youtube.com/vi/${vid}/hqdefault.jpg`;g('prev').style.display='block';}
  else{g('prev').style.display='none';curV='';if(v.length>8)g('uw').style.display='block';}
}
function openVid(){if(curV)window.open(`https://www.youtube.com/watch?v=${curV}`,'_blank');}
function adj(d){const i=g('ci');i.value=Math.max(1,Math.min(50,(parseInt(i.value)||1)+d));sync();}
g('ci').addEventListener('input',sync);
function sp(b,v){g('ci').value=v;sync();}
function sync(){const v=parseInt(g('ci').value);document.querySelectorAll('.pre').forEach(p=>p.classList.toggle('on',parseInt(p.textContent)===v));}
function sm(r){
  document.querySelectorAll('.mo').forEach(e=>e.classList.remove('sel'));
  r.closest('.mo').classList.add('sel');
  const isTab=r.value==='tabs';
  g('tip-tabs').style.display=isTab?'block':'none';
  g('tip-inline').style.display=isTab?'none':'block';
}
function launch(){
  const url=g('url-in').value.trim(),vid=gvid(url);
  if(!vid){g('uw').style.display='block';return;}
  const count=Math.max(1,Math.min(50,parseInt(g('ci').value)||5));
  const mode=document.querySelector('input[name="mode"]:checked').value;
  lastVid=vid;lastCount=count;
  if(mode==='tabs') openAllTabs(vid,count);
  else inlineMode(vid,count);
}

// â”€â”€ TABS MODE â”€â”€
function cleanTabUrl(vid,idx){
  const t=idx*3;
  return `https://www.youtube.com/watch?v=${vid}${t>0?'&t='+t:''}`;
}
function openAllTabs(vid,count){
  const sec=g('result-sec');sec.style.display='block';
  sec.scrollIntoView({behavior:'smooth',block:'start'});
  g('allow-guide').style.display='none';
  g('res-icon').textContent='ğŸš€';g('res-title').textContent=`Opening ${count} tabs...`;
  g('res-sub').textContent='â± Watch 30+ seconds per tab';
  g('res-total').textContent=`of ${count}`;g('res-bar').style.width='0%';g('res-opened').textContent='0 opened';
  const windows=[];
  for(let i=0;i<count;i++){const w=window.open('about:blank','_blank');if(w)windows.push(w);}
  let opened=0;
  windows.forEach((w,i)=>{
    setTimeout(()=>{
      try{
        w.location.href=cleanTabUrl(vid,i);
        opened++;
        g('res-bar').style.width=Math.round(opened/count*100)+'%';
        g('res-opened').textContent=opened+' opened';
        if(opened===count){
          g('res-icon').textContent='âœ…';
          g('res-title').textContent=`All ${count} tabs opened!`;
          g('res-sub').textContent='â± Watch each tab 30s+ Â· only ~4â€“5 will count from same IP';
          g('lb').disabled=false;
        }
      }catch(e){}
    },i*100);
  });
  if(windows.length===0)showBlockedGuide();
  else if(windows.length<count)setTimeout(()=>{g('res-icon').textContent='âš ï¸';showBlockedGuide();},600);
  else g('lb').disabled=true;
}
function showBlockedGuide(){g('allow-guide').style.display='block';g('lb').disabled=false;}
function retryLaunch(){if(lastVid)openAllTabs(lastVid,lastCount);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EMBED URL BUILDER
//
// KEY: youtube.com (not nocookie) + raw origin + enablejsapi=1
// mute=0 so YouTube registers audio engagement intent
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildEmbedSrc(vid,idx){
  const origin=location.origin||(location.protocol+'//'+location.host);
  const t=idx*3;
  return [
    `https://www.youtube.com/embed/${vid}`,
    `?autoplay=1`,
    `&mute=0`,
    `&rel=0`,
    `&playsinline=1`,
    `&enablejsapi=1`,
    `&origin=${origin}`,
    `&t=${t}`,
    `&modestbranding=1`
  ].join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COOKIE ISOLATION STRATEGY
//
// The core problem: all iframes in the same page share the
// same browser cookie jar â†’ YouTube sees them as one user.
//
// What we do:
// 1. Each iframe gets a unique `name` attribute â€” this creates
//    a separate browsing context in some browsers
//
// 2. We use `credentialless` iframe attribute (Chrome 110+)
//    This tells the browser to load the iframe WITHOUT sending
//    any credentials (cookies, storage) from the parent origin.
//    YouTube will then assign a FRESH anonymous session to
//    each iframe independently.
//    â†’ This is the closest thing to "a new private window per iframe"
//    â†’ Supported: Chrome 110+, Edge 110+
//    â†’ Not supported: Firefox, Safari (falls back to normal behavior)
//
// 3. Partition key isolation: in browsers that support
//    "storage partitioning" (Chrome 115+ Partitioned cookies /
//    CHIPS), cross-site iframes already get partitioned storage.
//    The `credentialless` attribute enforces this even harder.
//
// WHAT THIS MEANS FOR VIEWS:
//    â†’ Each `credentialless` iframe gets its own anonymous cookie
//      identity with YouTube â€” no shared VISITOR_INFO1_LIVE
//    â†’ YouTube sees each as a different anonymous visitor
//    â†’ Combined with different start times (t=), this is the
//      maximum possible session separation from one browser
//    â†’ Still same IP â†’ still ~4â€“5 views max/day from one network
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildIframeAttributes(iframeId, allow){
  // credentialless = separate cookie jar per iframe (Chrome 110+)
  // This is THE key fix for the Google account / cookie sharing problem
  return `
    id="${iframeId}"
    src=""
    frameborder="0"
    allowfullscreen
    credentialless
    name="yt-ctx-${iframeId}"
    allow="${allow}"
    referrerpolicy="strict-origin-when-cross-origin"
  `;
}

// Human behavior simulation
let humanSimInterval=null;
function startHumanSim(){
  if(humanSimInterval) return;
  let tick=0;
  humanSimInterval=setInterval(()=>{
    tick++;
    if(tick%3===0){
      document.dispatchEvent(new MouseEvent('mousemove',{
        bubbles:true,cancelable:true,
        clientX:100+Math.random()*400,
        clientY:200+Math.random()*300
      }));
    }
    if(tick%7===0) window.scrollBy(0,Math.random()>.5?1:-1);
    if(tick%10===0) window.focus();
  },2000);
}
function stopHumanSim(){clearInterval(humanSimInterval);humanSimInterval=null;}

// Prevent YouTube player from pausing when tab seems hidden
(function preventHidden(){
  try{
    Object.defineProperty(document,'visibilityState',{get:()=>'visible',configurable:true});
    Object.defineProperty(document,'hidden',{get:()=>false,configurable:true});
  }catch(e){}
})();

// â”€â”€ INLINE MODE â”€â”€
function inlineMode(vid,count){
  sf=false;totalPlaying=0;totalCounting=0;totalEligible=0;
  Object.keys(players).forEach(k=>{try{if(players[k].destroy)players[k].destroy();}catch(e){} delete players[k];});
  Object.keys(viewState).forEach(k=>{if(viewState[k].interval)clearInterval(viewState[k].interval);delete viewState[k];});
  loadYTApi();
  const fs=g('fr-sec'),fg=g('fg'),ps=g('prog-sec');
  ps.style.display='block';ps.scrollIntoView({behavior:'smooth',block:'start'});
  fs.style.display='block';fg.innerHTML='';
  g('pt2').textContent=`of ${count}`;g('pc2').textContent='0';
  g('pb2').style.width='0%';g('pd').textContent='0 done';
  g('lb').disabled=true;
  g('view-tracker').style.display='block';updateTracker();

  // Update tracker note based on login state
  const note=g('vt-note');
  if(note&&userIsLoggedIn){
    note.innerHTML=`âš ï¸ <b>You are logged in</b> â€” all iframes share your Google identity despite cookie isolation. Log out for better results.<br>âœ… <b>Eligible</b> = confirmed play (IFrame API state=1) + 30s watch time.`;
  }

  const thumb=`https://img.youtube.com/vi/${vid}/hqdefault.jpg`;
  const allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
  let n=0;

  inlineTimer=setInterval(()=>{
    if(sf||n>=count){
      clearInterval(inlineTimer);
      g('lb').disabled=false;
      g('fc').textContent=n;
      g('psub').textContent=sf?`Stopped at ${n}`:`âœ… ${n} screens ready â€” tap â–¶ or use Auto Play`;
      g('info-panel').style.display=sf?'none':'block';
      if(!sf)startHumanSim();
      fs.scrollIntoView({behavior:'smooth',block:'start'});
      return;
    }
    const idx=n;
    const embedSrc=buildEmbedSrc(vid,idx);
    const iframeId=`yt-iframe-${idx}`;

    const d=document.createElement('div');
    d.className='fi';
    d.dataset.src=embedSrc;
    d.dataset.idx=idx;
    d.dataset.iframeId=iframeId;
    d.innerHTML=`
      <div class="fp" onclick="playScreen(this)">
        <img src="${thumb}" alt="" loading="lazy">
        <div class="fp-overlay">
          <div class="fp-play"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
          <div class="fp-label">â–¶ Tap to Play Â· Screen #${idx+1}</div>
        </div>
      </div>
      <iframe ${buildIframeAttributes(iframeId,allow)}></iframe>
      <div class="fl">
        <span style="display:flex;align-items:center;gap:4px"><span class="fd"></span>#${idx+1}</span>
        <span class="vtimer" id="vt-${idx}">â± 30s</span>
      </div>`;
    g('fg').appendChild(d);

    n++;
    const pct=Math.round(n/count*100);
    g('pb2').style.width=pct+'%';g('pc2').textContent=n;
    g('pd').textContent=n+' done';g('fc').textContent=n;
    g('psub').textContent=`Created ${n} of ${count}...`;
  },200);
}

function playScreen(poster){
  const card=poster.closest('.fi');
  const iframe=document.getElementById(card.dataset.iframeId);
  const idx=parseInt(card.dataset.idx);
  iframe.src=card.dataset.src;
  card.classList.add('playing');
  const el=g('vt-'+idx);
  if(el){el.textContent='â³ Loading...';el.className='vtimer';}
  if(ytApiReady) setTimeout(()=>createYTPlayer(card.dataset.iframeId,idx),300);
  else ytInitQueue.push({iframeId:card.dataset.iframeId,idx});
}

function doStop(){
  sf=true;clearInterval(inlineTimer);stopHumanSim();
  g('lb').disabled=false;
  const s=g('sbtn');if(s){s.disabled=true;s.textContent='âœ… Stopped';}
}
function stopAllVideos(){
  sf=true;clearInterval(inlineTimer);stopHumanSim();g('lb').disabled=false;
  Object.keys(viewState).forEach(k=>{if(viewState[k].interval)clearInterval(viewState[k].interval);});
  Object.keys(players).forEach(k=>{try{if(players[k].stopVideo)players[k].stopVideo();}catch(e){}});
  document.querySelectorAll('#fg .fi.playing').forEach(card=>{
    const iframe=document.getElementById(card.dataset.iframeId);
    if(iframe)iframe.src='';
    card.classList.remove('playing');
  });
  totalPlaying=0;updateTracker();
  const b=g('stopall-btn');
  if(b){b.textContent='âœ… Stopped';b.disabled=true;setTimeout(()=>{b.textContent='â¹ Stop All';b.disabled=false;},2000);}
}
function clrF(){
  sf=true;clearInterval(inlineTimer);stopHumanSim();
  Object.keys(viewState).forEach(k=>{if(viewState[k].interval)clearInterval(viewState[k].interval);});
  Object.keys(players).forEach(k=>{try{if(players[k].destroy)players[k].destroy();}catch(e){}});
  g('lb').disabled=false;
  document.querySelectorAll('#fg iframe').forEach(f=>f.src='');
  g('fg').innerHTML='';g('fr-sec').style.display='none';
  g('prog-sec').style.display='none';g('info-panel').style.display='none';
  g('view-tracker').style.display='none';g('fc').textContent='0';
  totalPlaying=0;totalCounting=0;totalEligible=0;updateTracker();
  const s=g('sbtn');if(s){s.disabled=false;s.textContent='â¹ Stop';}
}

let autoPlayTimer=null;
function autoPlayAll(){
  const btn=g('autoplay-btn');
  const posters=document.querySelectorAll('#fg .fi:not(.playing) .fp');
  if(!posters.length){
    if(btn){btn.textContent='âœ… All Already Playing';setTimeout(()=>{btn.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M8 5v14l11-7z"/></svg> â–¶ Auto Play All Screens';},1500);}
    return;
  }
  if(btn){btn.disabled=true;btn.textContent=`â³ Starting ${posters.length} screens...`;}
  let i=0;clearInterval(autoPlayTimer);
  autoPlayTimer=setInterval(()=>{
    const rem=document.querySelectorAll('#fg .fi:not(.playing) .fp');
    if(!rem.length||i>=posters.length){
      clearInterval(autoPlayTimer);
      if(btn){btn.disabled=false;btn.innerHTML='âœ… All Playing â€” watch 30s each!';setTimeout(()=>{btn.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M8 5v14l11-7z"/></svg> â–¶ Auto Play All Screens';},3000);}
      return;
    }
    rem[0].click();i++;
    const left=document.querySelectorAll('#fg .fi:not(.playing) .fp').length;
    if(btn&&left>0)btn.textContent=`â³ ${i} started, ${left} remaining...`;
  },1200);
}

// â”€â”€ INIT â”€â”€
detectLoginStatus();
</script>
</body>
</html>
